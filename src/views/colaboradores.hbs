<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <title>Gesti√≥n de Onboarding</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-[#f4f6fb] via-white to-[#e5ecfa]">

  <div class="max-w-6xl mx-auto mt-10 mb-10 bg-white/95 backdrop-blur-xl border border-[#d2ddf5] p-6 md:p-8 shadow-[0_18px_40px_rgba(0,0,0,0.08)] rounded-2xl space-y-8">

    <header class="relative overflow-hidden rounded-2xl border border-[#d2ddf5] bg-gradient-to-r from-[#0033a0] via-[#0046c0] to-[#005bea] px-5 py-4 md:px-6 md:py-5 text-white shadow-sm">
      <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
        <div class="space-y-1">
          <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10 text-xs font-medium">
            <span class="inline-flex h-6 w-6 items-center justify-center rounded-full bg-[#ffc20e] text-[#0033a0] text-sm font-bold">
              B
            </span>
            <span>Onboarding talento ¬∑ Banco de Bogot√°</span>
          </div>
          <h1 class="text-2xl md:text-3xl font-semibold tracking-tight text-white">
            Gesti√≥n de Onboarding de Colaboradores
          </h1>
          <p class="text-xs md:text-sm text-white/80 max-w-xl">
            Administra el registro de colaboradores, el avance de sus procesos de bienvenida y formaci√≥n t√©cnica, y el calendario de sesiones clave desde un solo lugar.
          </p>
        </div>
        <nav class="flex flex-wrap gap-2 text-xs md:text-sm bg-white/10 px-2.5 py-2 rounded-2xl border border-white/20 backdrop-blur-sm">
          <button
            type="button"
            data-section-target="registro"
            class="section-tab inline-flex items-center gap-2 px-3 py-1.5 rounded-lg border border-transparent text-white/80 hover:bg-white/10 hover:text-white transition"
          >
            <span>üë§</span>
            <span>Registro</span>
          </button>
          <button
            type="button"
            data-section-target="dashboard"
            class="section-tab inline-flex items-center gap-2 px-3 py-1.5 rounded-lg border border-[#ffc20e] bg-[#ffc20e] text-[#0033a0] font-semibold shadow-sm"
          >
            <span>üìä</span>
            <span>Dashboard</span>
          </button>
          <button
            type="button"
            data-section-target="calendario"
            class="section-tab inline-flex items-center gap-2 px-3 py-1.5 rounded-lg border border-transparent text-white/80 hover:bg-white/10 hover:text-white transition"
          >
            <span>üìÖ</span>
            <span>Calendario t√©cnico</span>
          </button>
        </nav>
      </div>
      <span class="pointer-events-none absolute inset-y-0 right-0 w-40 bg-[radial-gradient(circle_at_top,_rgba(255,194,14,0.4),_transparent_60%)] opacity-80"></span>
    </header>

    <!-- 1. Registro de colaboradores -->
    <section id="registro" class="section-panel space-y-4 hidden">
      <h2 class="text-xl font-semibold text-slate-900">üßë‚Äçüíº Registro de colaboradores</h2>
      <p class="text-sm text-slate-600">
        Crea nuevos colaboradores indicando su fecha de ingreso y, opcionalmente, una fecha de onboarding t√©cnico asignada.
        Los estados de onboarding se inician como pendientes (‚ùå) y se pueden marcar como completados desde el dashboard.
      </p>

      <!-- Bot√≥n tipo tarjeta para mostrar el formulario -->
      <button
        type="button"
        id="btnMostrarRegistro"
        class="w-full md:w-auto flex items-center gap-3 bg-white border border-dashed border-[#c5d2f0] rounded-xl px-4 py-3 shadow-sm hover:border-[#0033a0] hover:shadow-md transition"
      >
        <div class="flex h-10 w-10 items-center justify-center rounded-full bg-[#0033a0] text-white text-2xl">
          üë§+
        </div>
        <div class="flex flex-col items-start text-left">
          <span class="text-sm font-semibold text-gray-800">Agregar nuevo colaborador</span>
          <span class="text-xs text-gray-500">Haz clic para abrir el formulario de registro</span>
        </div>
      </button>

      <!-- Formulario de registro (oculto por defecto) -->
      <form
        id="formRegistroColaborador"
        action="/colaboradores/crear"
        method="POST"
        class="grid grid-cols-1 md:grid-cols-4 gap-4 bg-[#f7f8fc] p-4 rounded-xl border border-[#d2ddf5] mt-4 hidden"
      >
        <div class="md:col-span-2">
          <label class="block text-sm font-medium mb-1">Nombre completo</label>
          <input name="nombre" class="w-full border p-2 rounded" placeholder="Nombre completo" required>
        </div>
        <div class="md:col-span-2">
          <label class="block text-sm font-medium mb-1">Correo electr√≥nico</label>
          <input name="correo" type="email" class="w-full border p-2 rounded" placeholder="correo@empresa.com" required>
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Fecha de ingreso</label>
          <input name="fecha_ingreso" type="date" class="w-full border p-2 rounded" required>
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Fecha onboarding t√©cnico (opcional)</label>
          <input name="fecha_onboarding_tecnico" type="date" class="w-full border p-2 rounded">
        </div>
        <div class="md:col-span-2 flex items-end gap-2">
          <button class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">
            Guardar colaborador
          </button>
          <button
            type="button"
            id="btnCerrarRegistro"
            class="whitespace-nowrap px-3 py-2 border border-gray-300 rounded text-xs text-gray-600 hover:bg-gray-100"
          >
            Cancelar
          </button>
        </div>
      </form>
    </section>

    <!-- 2. Dashboard de colaboradores -->
    <section id="dashboard" class="section-panel space-y-4">
      <h2 class="text-xl font-semibold text-slate-900">üìä Dashboard de colaboradores</h2>
      <p class="text-sm text-slate-600">
        Visualiza el estado de los onboardings de bienvenida y t√©cnico, filtra por tipo y estado, y marca los procesos como completados.
        Tambi√©n puedes editar los datos de cada colaborador desde esta misma vista.
      </p>

      <!-- Filtros -->
      <form method="GET" action="/colaboradores" class="flex flex-wrap items-end gap-4 bg-[#f7f8fc] p-4 rounded-xl border border-[#d2ddf5]">
        <div>
          <label class="block text-sm font-medium mb-1">Tipo de onboarding</label>
          <select name="tipoOnboarding" class="border p-2 rounded">
            <option value="" {{#unless tieneFiltroTipo}}selected{{/unless}}>Todos</option>
            <option value="bienvenida" {{#if esBienvenida}}selected{{/if}}>Bienvenida general</option>
            <option value="tecnico" {{#if esTecnico}}selected{{/if}}>T√©cnico</option>
          </select>
        </div>

        <div>
          <label class="block text-sm font-medium mb-1">Estado</label>
          <select name="estado" class="border p-2 rounded">
            <option value="" {{#unless tieneFiltroEstado}}selected{{/unless}}>Todos</option>
            <option value="completado" {{#if estadoCompletado}}selected{{/if}}>Completado</option>
            <option value="pendiente" {{#if estadoPendiente}}selected{{/if}}>Pendiente</option>
          </select>
        </div>

        <div>
          <label class="block text-sm font-medium mb-1">Nombre</label>
          <input
            type="text"
            name="nombre"
            class="border p-2 rounded w-full"
            placeholder="Buscar por nombre"
            value="{{filtroNombre}}"
          />
        </div>

        <div>
          <label class="block text-sm font-medium mb-1">Correo</label>
          <input
            type="text"
            name="correo"
            class="border p-2 rounded w-full"
            placeholder="Buscar por correo"
            value="{{filtroCorreo}}"
          />
        </div>

        <div class="w-full flex justify-end pt-2">
          <button class="bg-[#0033a0] text-white px-4 py-2 rounded-lg hover:bg-[#00246e] shadow-sm text-sm font-medium">
            Aplicar filtros
          </button>
        </div>
      </form>

      <!-- Tabla de colaboradores -->
      <div class="overflow-x-auto border border-[#d2ddf5] rounded-xl shadow-sm bg-white">
        <table class="min-w-full border-collapse text-sm text-slate-700">
          <thead>
            <tr class="bg-[#eef2ff]">
              <th class="p-2 border text-left text-xs font-semibold text-slate-700">Nombre</th>
              <th class="p-2 border text-left text-xs font-semibold text-slate-700">Correo</th>
              <th class="p-2 border text-left text-xs font-semibold text-slate-700">Fecha ingreso</th>
              <th class="p-2 border text-left text-xs font-semibold text-slate-700">Onb. Bienvenida</th>
              <th class="p-2 border text-left text-xs font-semibold text-slate-700">Onb. T√©cnico</th>
              <th class="p-2 border text-left text-xs font-semibold text-slate-700">Fecha Onb. T√©cnico</th>
              <th class="p-2 border text-left text-xs font-semibold text-slate-700">Acciones</th>
            </tr>
          </thead>
          <tbody>
            {{#if colaboradores.length}}
              {{#each colaboradores}}
                <tr class="align-top even:bg-[#f4f6ff]">
                  <td class="p-2 border">{{nombre}}</td>
                  <td class="p-2 border">{{correo}}</td>
                  <td class="p-2 border">{{fecha_ingreso_display}}</td>
                  <td class="p-2 border text-center">
                    {{#if onboarding_bienvenida}}‚úÖ{{else}}‚ùå{{/if}}
                  </td>
                  <td class="p-2 border text-center">
                    {{#if onboarding_tecnico}}‚úÖ{{else}}‚ùå{{/if}}
                  </td>
                  <td class="p-2 border text-center">
                    {{#if fecha_onboarding_tecnico_display}}
                      {{fecha_onboarding_tecnico_display}}
                    {{else}}
                      -
                    {{/if}}
                  </td>
                  <td class="p-2 border">
                    <div class="flex flex-col gap-1">
                      {{!-- Marcar bienvenida completada --}}
                      {{#unless onboarding_bienvenida}}
                        <form method="POST" action="/colaboradores/{{id}}/marcar">
                          <input type="hidden" name="tipo" value="bienvenida">
                          <button class="w-full bg-green-600 text-white px-2 py-1 rounded text-xs hover:bg-green-700">
                            Marcar bienvenida
                          </button>
                        </form>
                      {{/unless}}

                      {{!-- Marcar t√©cnico completado --}}
                      {{#unless onboarding_tecnico}}
                        <form method="POST" action="/colaboradores/{{id}}/marcar">
                          <input type="hidden" name="tipo" value="tecnico">
                          <button class="w-full bg-blue-600 text-white px-2 py-1 rounded text-xs hover:bg-blue-700">
                            Marcar t√©cnico
                          </button>
                        </form>
                      {{/unless}}

                      {{!-- Edici√≥n inline --}}
                      <details class="mt-1">
                        <summary class="text-xs text-blue-700 cursor-pointer">Editar</summary>
                        <form method="POST" action="/colaboradores/{{id}}/actualizar" class="mt-2 space-y-1 text-xs bg-[#f7f8fc] p-2 rounded border border-[#d2ddf5]">
                          <div>
                            <label class="block mb-1">Nombre</label>
                            <input name="nombre" class="w-full border p-1 rounded" value="{{nombre}}">
                          </div>
                          <div>
                            <label class="block mb-1">Correo</label>
                            <input name="correo" class="w-full border p-1 rounded" value="{{correo}}">
                          </div>
                          <div>
                            <label class="block mb-1">Fecha ingreso</label>
                            <input name="fecha_ingreso" type="date" class="w-full border p-1 rounded" value="{{fecha_ingreso_input}}">
                          </div>
                          <div>
                            <label class="block mb-1">Fecha onboarding t√©cnico</label>
                            <input name="fecha_onboarding_tecnico" type="date" class="w-full border p-1 rounded" value="{{fecha_onboarding_tecnico_input}}">
                          </div>
                          <div class="flex items-center gap-2 mt-1">
                            <label class="flex items-center gap-1">
                              <input type="checkbox" name="onboarding_bienvenida" {{#if onboarding_bienvenida}}checked{{/if}}>
                              <span>Bienvenida completada</span>
                            </label>
                          </div>
                          <div class="flex items-center gap-2">
                            <label class="flex items-center gap-1">
                              <input type="checkbox" name="onboarding_tecnico" {{#if onboarding_tecnico}}checked{{/if}}>
                              <span>T√©cnico completado</span>
                            </label>
                          </div>
                          <div class="pt-2">
                            <button class="w-full bg-indigo-600 text-white py-1 rounded hover:bg-indigo-700">
                              Guardar cambios
                            </button>
                          </div>
                        </form>
                      </details>
                    </div>
                  </td>
                </tr>
              {{/each}}
            {{else}}
              <tr>
                <td colspan="7" class="p-4 border text-center text-gray-500">
                  No hay colaboradores registrados todav√≠a.
                </td>
              </tr>
            {{/if}}
          </tbody>
        </table>
      </div>
    </section>

    <!-- 3. Calendario de Onboardings T√©cnicos -->
    <section id="calendario" class="section-panel space-y-4 hidden">
      <h2 class="text-xl font-semibold text-slate-900">üìÖ Calendario de Onboardings T√©cnicos</h2>
      <p class="text-sm text-slate-600">
        Gestiona el calendario anual de sesiones t√©cnicas como Journey to Cloud y otros cap√≠tulos. 
        Cada bloque puede representar entre 5 y 7 d√≠as de formaci√≥n.
      </p>

      <!-- Filtro por rango de fechas -->
      <form method="GET" action="/colaboradores" class="flex flex-wrap items-end gap-4 bg-[#f3f6ff] p-4 rounded-xl border border-[#d2ddf5]">
        <div>
          <label class="block text-sm font-medium mb-1">Fecha inicio (desde)</label>
          <input name="desde" type="date" class="border p-2 rounded w-full">
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Fecha fin (hasta)</label>
          <input name="hasta" type="date" class="border p-2 rounded w-full">
        </div>
        <button class="bg-[#0033a0] text-white px-4 py-2 rounded-lg hover:bg-[#00246e] shadow-sm text-sm font-medium">
          Filtrar calendario
        </button>
      </form>

      <!-- Calendario anual visual -->
      <div class="rounded-2xl border border-[#d2ddf5] bg-white p-4 md:p-5 shadow-sm space-y-3">
        <div class="flex items-center justify-between gap-2">
          <div>
            <p class="text-xs font-medium text-slate-500 uppercase tracking-wide">Calendario anual</p>
            <p class="text-sm text-slate-700">
              Vista resumida de bloques activos (5‚Äì7 d√≠as) para Journey to Cloud y otros cap√≠tulos t√©cnicos.
            </p>
          </div>
          <div class="hidden md:flex items-center gap-2 text-[11px] text-slate-500">
            <span class="inline-flex h-2 w-6 rounded-full bg-[#003fa8]"></span> Sesi√≥n activa
            <span class="inline-flex h-2 w-6 rounded-full bg-[#9ca3af]"></span> L√≠nea de tiempo
          </div>
        </div>

        {{#if sesiones.length}}
          <div class="space-y-3">
            {{#each sesiones}}
              <div class="space-y-1">
                <div class="flex items-center justify-between text-[11px] md:text-xs">
                  <div class="flex flex-col">
                    <span class="font-medium text-slate-700">
                      {{nombre}}
                      {{#if capitulo}} ¬∑ {{capitulo}}{{/if}}
                    </span>
                    <span class="text-slate-500">
                      {{fecha_inicio_display}} ‚Äî {{fecha_fin_display}}
                    </span>
                  </div>
                  <span class="ml-4 text-slate-500">
                    Bloque de {{duracion_dias}} d√≠as
                  </span>
                </div>
                <div class="h-2 w-full rounded-full bg-[#e5e7eb] overflow-hidden">
                  <div
                    class="h-2 rounded-full bg-[#003fa8]"
                    style="width: {{duracion_dias}}0%; max-width: 100%;"
                  ></div>
                </div>
              </div>
            {{/each}}
          </div>
        {{else}}
          <p class="text-xs text-slate-500">
            A√∫n no hay sesiones t√©cnicas configuradas. Crea bloques de 5 a 7 d√≠as para Journey to Cloud y otros cap√≠tulos usando el formulario inferior.
          </p>
        {{/if}}
      </div>

      <!-- Formulario para crear sesiones de onboarding t√©cnico -->
      <form action="/calendario/crear" method="POST" class="grid grid-cols-1 md:grid-cols-4 gap-4 bg-[#f7f8fc] p-4 rounded-xl border border-[#d2ddf5]">
        <div>
          <label class="block text-sm font-medium mb-1">Nombre de la sesi√≥n</label>
          <input name="nombre" class="w-full border p-2 rounded" placeholder="Journey to Cloud" required>
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Cap√≠tulo (opcional)</label>
          <input name="capitulo" class="w-full border p-2 rounded" placeholder="Data, DevOps, etc.">
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Responsable (nombre)</label>
          <input name="responsable_nombre" class="w-full border p-2 rounded" placeholder="Nombre del responsable">
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Responsable (correo)</label>
          <input name="responsable_correo" type="email" class="w-full border p-2 rounded" placeholder="responsable@empresa.com">
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Fecha inicio</label>
          <input name="fecha_inicio" type="date" class="w-full border p-2 rounded" required>
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Fecha fin</label>
          <input name="fecha_fin" type="date" class="w-full border p-2 rounded" required>
        </div>
        <div class="md:col-span-4 flex justify-end">
          <button class="bg-emerald-600 text-white px-4 py-2 rounded hover:bg-emerald-700">
            Agregar sesi√≥n al calendario
          </button>
        </div>
      </form>

      <!-- Tabla de sesiones -->
      <div class="overflow-x-auto border border-[#d2ddf5] rounded-xl shadow-sm bg-white">
        <table class="min-w-full border-collapse text-sm text-slate-700">
          <thead>
            <tr class="bg-[#eef2ff]">
              <th class="p-2 border text-left text-xs font-semibold text-slate-700">Nombre</th>
              <th class="p-2 border text-left text-xs font-semibold text-slate-700">Cap√≠tulo</th>
              <th class="p-2 border text-left text-xs font-semibold text-slate-700">Responsable</th>
              <th class="p-2 border text-left text-xs font-semibold text-slate-700">Correo responsable</th>
              <th class="p-2 border text-left text-xs font-semibold text-slate-700">Fecha inicio</th>
              <th class="p-2 border text-left text-xs font-semibold text-slate-700">Fecha fin</th>
              <th class="p-2 border text-left text-xs font-semibold text-slate-700">Duraci√≥n (d√≠as)</th>
              <th class="p-2 border text-left text-xs font-semibold text-slate-700">Recordar</th>
            </tr>
          </thead>
          <tbody>
            {{#if sesiones.length}}
              {{#each sesiones}}
                <tr class="even:bg-[#f4f6ff]">
                  <td class="p-2 border">{{nombre}}</td>
                  <td class="p-2 border">{{capitulo}}</td>
                  <td class="p-2 border">{{responsable_nombre}}</td>
                  <td class="p-2 border">{{responsable_correo}}</td>
                  <td class="p-2 border">{{fecha_inicio_display}}</td>
                  <td class="p-2 border">{{fecha_fin_display}}</td>
                  <td class="p-2 border text-center">
                    {{duracion_dias}}
                  </td>
                  <td class="p-2 border text-center">
                    <form method="POST" action="/alertas/enviar-uno">
                      <input type="hidden" name="id" value="{{id}}">
                      <button class="bg-purple-500 text-white px-3 py-1 rounded text-xs hover:bg-purple-600">
                        Recordar
                      </button>
                    </form>
                  </td>
                </tr>
              {{/each}}
            {{else}}
              <tr>
                <td colspan="8" class="p-4 border text-center text-gray-500">
                  No hay sesiones t√©cnicas configuradas todav√≠a.
                </td>
              </tr>
            {{/if}}
          </tbody>
        </table>
      </div>
    </section>

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        // Toggle del formulario de registro
        const btnMostrar = document.getElementById('btnMostrarRegistro');
        const btnCerrar = document.getElementById('btnCerrarRegistro');
        const form = document.getElementById('formRegistroColaborador');

        if (btnMostrar && form) {
          btnMostrar.addEventListener('click', () => {
            const isHidden = form.classList.contains('hidden');
            if (isHidden) {
              form.classList.remove('hidden');
              btnMostrar.classList.add('hidden');
            } else {
              form.classList.add('hidden');
              btnMostrar.classList.remove('hidden');
            }
          });
        }

        if (btnCerrar && form && btnMostrar) {
          btnCerrar.addEventListener('click', () => {
            form.classList.add('hidden');
            btnMostrar.classList.remove('hidden');
          });
        } 

        // Tabs de secciones: Registro, Dashboard, Calendario, Alertas
        const tabs = document.querySelectorAll('.section-tab');
        const panels = document.querySelectorAll('.section-panel');

        function activateSection(targetId) {
          // Mostrar solo el panel objetivo
          panels.forEach(panel => {
            if (panel.id === targetId) {
              panel.classList.remove('hidden');
            } else {
              panel.classList.add('hidden');
            }
          });

          // Estilos de tab activo / inactivo
          tabs.forEach(tab => {
            const tabTarget = tab.getAttribute('data-section-target');
            if (tabTarget === targetId) {
              tab.classList.add('bg-[#ffc20e]', 'text-[#0033a0]', 'border-[#ffc20e]', 'shadow-sm', 'font-semibold');
              tab.classList.remove('border-transparent', 'text-slate-600');
            } else {
              tab.classList.remove('bg-[#ffc20e]', 'text-[#0033a0]', 'border-[#ffc20e]', 'shadow-sm', 'font-semibold');
              tab.classList.add('border-transparent', 'text-slate-600');
            }
          });
        }

        tabs.forEach(tab => {
          tab.addEventListener('click', () => {
            const target = tab.getAttribute('data-section-target');
            if (target) {
              activateSection(target);
            }
          });
        });

        // Al cargar, decidir secci√≥n inicial seg√∫n los filtros:
        // - Si viene rango de fechas (desde/hasta) => abrir Calendario
        // - En caso contrario => Dashboard por defecto
        const searchParams = new URLSearchParams(window.location.search);
        const tieneRangoCalendario = searchParams.has('desde') || searchParams.has('hasta');

        if (tieneRangoCalendario) {
          activateSection('calendario');
        } else {
          activateSection('dashboard');
        }
      });
    </script>
    
</body>
</html>